# Borealis 框架接口文档（基于 Demo 示例）

本文档根据提供的 demo 代码整理，介绍了 Borealis 框架的核心接口、类、宏及使用方法。Borealis 是一个 C++ 编写的 GUI 框架，采用类似 Android 的 XML 布局 + 视图绑定的模式，适用于游戏主机类应用。

---

## 一、应用生命周期

### 1. 初始化与主循环
```cpp
#include <borealis.hpp>

int main(int argc, char* argv[]) {
    // 可选：解析命令行参数设置日志等
    brls::Logger::setLogLevel(brls::LogLevel::LOG_DEBUG);

    // 初始化框架
    if (!brls::Application::init()) {
        return EXIT_FAILURE;
    }

    // 创建主窗口，标题支持国际化
    brls::Application::createWindow("app/title"_i18n);

    // 设置主题（亮色/暗色）
    brls::Application::getPlatform()->setThemeVariant(brls::ThemeVariant::DARK);

    // 注册自定义视图（用于 XML 解析）
    brls::Application::registerXMLView("CustomView", CustomView::create);

    // 推送初始 Activity
    brls::Application::pushActivity(new MainActivity());

    // 主循环
    while (brls::Application::mainLoop());

    return EXIT_SUCCESS;
}
```

### 2. 日志与调试
```cpp
brls::Logger::setLogLevel(brls::LogLevel::LOG_DEBUG);   // 设置日志级别
brls::Logger::info("message");                           // 输出信息
brls::Application::enableDebuggingView(true);            // 显示调试层（布局边框等）
```

### 3. 全局配置
```cpp
brls::Application::setGlobalQuit(false);      // 是否允许按 START 键全局退出
brls::Application::setFPSStatus(true);         // 显示 FPS
brls::Application::setSwapInterval(1);         // 设置交换间隔
```

---

## 二、Activity 与界面管理

### 1. Activity 定义
每个 Activity 对应一个全屏界面，通过 `CONTENT_FROM_XML_RES` 宏指定布局文件。
```cpp
#pragma once
#include <borealis.hpp>

class MainActivity : public brls::Activity {
public:
    CONTENT_FROM_XML_RES("activity/main.xml");
};
```

### 2. Activity 导航
```cpp
brls::Application::pushActivity(new MainActivity());      // 压入新 Activity
brls::Application::popActivity();                          // 弹出当前 Activity
```

### 3. 视图栈与全局操作
```cpp
auto stack = brls::Application::getActivitiesStack();      // 获取所有 Activity
```

---

## 三、视图系统

### 1. 基础视图类
所有视图继承自 `brls::View`，常用子类：
- `brls::Box`：线性布局容器（axis 可设为 `column` 或 `row`）
- `brls::Label`：文本标签
- `brls::Button`：按钮
- `brls::Image`：图片
- `brls::Slider`：滑块
- `brls::RecyclerFrame`：高效列表
- `brls::AppletFrame`：带标题栏的框架
- `brls::TabFrame`：多标签页容器

### 2. 视图属性（XML 支持）
- 尺寸：`width`、`height`（支持 `auto`、百分比、像素值）
- 边距：`margin`、`marginTop`、`marginBottom`、`marginLeft`、`marginRight`
- 内边距：`paddingTop` 等
- 对齐：`horizontalAlign`、`verticalAlign`
- 文本：`text`（支持国际化 `@i18n/...`）
- 图片：`image`（支持 `@res/...` 资源路径）
- ID：`id`（用于 `BRLS_BIND` 绑定）

### 3. 视图绑定（BRLS_BIND 宏）
在 C++ 类中声明成员变量，自动绑定 XML 中指定 ID 的视图。
```cpp
class MyView : public brls::Box {
public:
    MyView() {
        this->inflateFromXMLRes("xml/my_view.xml");
    }
    BRLS_BIND(brls::Label, label, "label_id");
    BRLS_BIND(brls::Button, button, "button_id");
};
```

### 4. 自定义视图注册
```cpp
brls::Application::registerXMLView("MyView", MyView::create);
```
`create` 静态方法需返回新实例：
```cpp
brls::View* MyView::create() { return new MyView(); }
```

### 5. 加载内嵌 XML 或子布局
```cpp
// 在当前视图中加载另一个 XML 文件作为子视图
this->inflateFromXMLRes("xml/sub_layout.xml");

// 在 XML 中引用外部布局
<brls:View xml="@res/xml/other.xml" />
```

---

## 四、事件处理

### 1. 按钮点击
```cpp
button->registerClickAction([this](brls::View* view) {
    // 处理点击
    return true; // 表示事件已消费
});
```

### 2. 通用按键动作
```cpp
view->registerAction("Action Name", brls::BUTTON_A, [](brls::View* view) {
    // 处理按键
    return true;
}, false, false, brls::SOUND_CLICK);
```

### 3. 滑块事件
```cpp
slider->getProgressEvent()->subscribe([this](float progress) {
    label->setText(std::to_string((int)(progress * 100)));
});
```

### 4. 焦点变化
```cpp
void onChildFocusGained(brls::View* directChild, brls::View* focusedView) override;
void onChildFocusLost(brls::View* directChild, brls::View* focusedView) override;
```

### 5. 手势识别
```cpp
view->addGestureRecognizer(new brls::TapGestureRecognizer(view));
```

---

## 五、列表（RecyclerFrame）

### 1. 数据源（继承 `brls::RecyclerDataSource`）
```cpp
class DataSource : public brls::RecyclerDataSource {
public:
    int numberOfSections(brls::RecyclerFrame* recycler) override;
    int numberOfRows(brls::RecyclerFrame* recycler, int section) override;
    std::string titleForHeader(brls::RecyclerFrame* recycler, int section) override;
    brls::RecyclerCell* cellForRow(brls::RecyclerFrame* recycler, brls::IndexPath index) override;
    void didSelectRowAt(brls::RecyclerFrame* recycler, brls::IndexPath indexPath) override;
};
```

### 2. 单元格（继承 `brls::RecyclerCell`）
```cpp
class MyCell : public brls::RecyclerCell {
public:
    MyCell() { this->inflateFromXMLRes("xml/cell.xml"); }
    static MyCell* create() { return new MyCell(); }
    BRLS_BIND(brls::Label, label, "label");
};
```

### 3. 注册与使用
```cpp
recycler->estimatedRowHeight = 70;
recycler->registerCell("Cell", []() { return MyCell::create(); });
recycler->setDataSource(new DataSource());
```

---

## 六、动画（Animatable）

```cpp
brls::Animatable anim;
anim.reset(0);
anim.addStep(1.0, 2000, brls::EasingFunction::exponentialOut); // 目标值、时长、缓动函数
anim.setTickCallback([this](float value) {
    view->setScale(value);
});
anim.start();
// anim.stop();
```

---

## 七、对话框与通知

### 1. 对话框
```cpp
auto dialog = new brls::Dialog("Message");
dialog->addButton("OK", []() {});
dialog->open();
```

### 2. 下拉选择框
```cpp
brls::Dropdown* dropdown = new brls::Dropdown(
    "Title",
    {"Option1", "Option2"},
    [](int selected) { /* 处理选择 */ },
    defaultIndex
);
brls::Application::pushActivity(new brls::Activity(dropdown));
```

### 3. 通知
```cpp
brls::Application::notify("Notification text");
```

---

## 八、主题与样式

### 1. 主题颜色
```cpp
brls::Theme::getLightTheme().addColor("key", nvgRGB(255,0,0));
brls::Theme::getDarkTheme().addColor("key", nvgRGB(0,255,0));
```

### 2. 样式尺寸
```cpp
brls::getStyle().addMetric("key", 50);
```
在 XML 中使用：`paddingTop="@style/key"`

### 3. 获取当前主题值
```cpp
NVGcolor color = theme["key"];
```

---

## 九、平台相关接口

```cpp
auto platform = brls::Application::getPlatform();
platform->setWindowAlwaysOnTop(true);
platform->disableScreenDimming(true);
platform->openBrowser("https://example.com");
platform->getIpAddress();
platform->getDnsServer();
platform->setBacklightBrightness(0.5f);
```

---

## 十、国际化（i18n）

1. 定义字符串资源（通常为 JSON 或自定义格式）。
2. 在代码中使用 `"key"_i18n` 字面量（需 `using namespace brls::literals;`）。
3. 在 XML 中使用 `@i18n/path/to/key`。

---

## 小型 Demo：带按钮的计数器

### 1. XML 布局：`resources/xml/activity/counter.xml`
```xml
<brls:Box
    width="auto"
    height="auto"
    axis="column"
    justifyContent="center"
    alignItems="center">

    <brls:Label
        id="counter_label"
        text="0"
        fontSize="48"
        marginBottom="20"/>

    <brls:Button
        id="increment_button"
        label="Increment"/>

</brls:Box>
```

### 2. C++ 活动类：`counter_activity.hpp`
```cpp
#pragma once
#include <borealis.hpp>

class CounterActivity : public brls::Activity {
public:
    CONTENT_FROM_XML_RES("activity/counter.xml");
};
```

### 3. 主程序：`main.cpp`
```cpp
#include <borealis.hpp>
#include "counter_activity.hpp"

using namespace brls::literals;

int main(int argc, char* argv[]) {
    brls::Logger::setLogLevel(brls::LogLevel::LOG_DEBUG);

    if (!brls::Application::init())
        return EXIT_FAILURE;

    brls::Application::createWindow("Counter Demo"_i18n);
    brls::Application::getPlatform()->setThemeVariant(brls::ThemeVariant::DARK);

    // 注册自定义视图（此处无，但保留）
    // brls::Application::registerXMLView(...);

    // 创建并绑定视图
    class CounterView : public brls::Box {
    public:
        CounterView() {
            this->inflateFromXMLRes("xml/activity/counter.xml");
            counter = 0;
            label->setText("0");

            button->registerClickAction([this](brls::View* view) {
                counter++;
                label->setText(std::to_string(counter));
                return true;
            });
        }

    private:
        int counter;
        BRLS_BIND(brls::Label, label, "counter_label");
        BRLS_BIND(brls::Button, button, "increment_button");
    };

    // 自定义活动（可改为使用上面的 CounterActivity，但为了演示直接在 main 中构建视图）
    class MyActivity : public brls::Activity {
    public:
        MyActivity() {
            brls::AppletFrame* frame = new brls::AppletFrame();
            frame->setContentView(new CounterView());
            frame->setTitle("Counter");
            this->setContentView(frame);
        }
    };

    brls::Application::pushActivity(new MyActivity());

    while (brls::Application::mainLoop());

    return EXIT_SUCCESS;
}
```

### 4. 运行效果
启动后显示一个带数字的标签和一个按钮，每次点击按钮数字加一。

---

以上是基于 demo 提取的核心接口和小型示例。实际开发中可参考 demo 中的完整实现，结合 XML 布局和 C++ 逻辑快速构建应用。